<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row =>
                    row.some(cell => cell !== '' && cell !== null && cell !== undefined)
                );

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع حفظ القصائد</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.9/babel.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            overflow-x: hidden;
        }
        .poem-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 16px;
        }
        .verse {
            margin-bottom: 16px;
            padding: 16px;
            border-right: 4px solid #4a90e2;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .verse:hover {
            transform: translateX(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .verse.memorized {
            background-color: #f0fff4;
            border-right-color: #28a745;
        }
        .verse p {
            font-family: 'Traditional Arabic', 'Amiri', serif;
            font-size: 1.25rem;
            line-height: 2;
            text-align: center;
            margin-bottom: 12px;
        }
        .dropdown {
            position: sticky;
            top: 10px;
            z-index: 10;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .progress-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .progress-bar-fill {
            height: 100%;
            background-color: #28a745;
            transition: width 0.5s ease;
            background-image: linear-gradient(45deg, 
                rgba(255,255,255,.15) 25%, 
                transparent 25%, 
                transparent 50%, 
                rgba(255,255,255,.15) 50%, 
                rgba(255,255,255,.15) 75%, 
                transparent 75%, 
                transparent);
            background-size: 1rem 1rem;
            animation: progress-bar-stripes 1s linear infinite;
        }
        @keyframes progress-bar-stripes {
            from { background-position: 1rem 0; }
            to { background-position: 0 0; }
        }
        .tts-controls {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }
        .tts-controls input[type="range"] {
            height: 6px;
            border-radius: 3px;
            background: #e9ecef;
            outline: none;
            transition: background 0.3s;
        }
        .tts-controls input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4a90e2;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tts-controls input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        .poem-title {
            font-family: 'Traditional Arabic', 'Amiri', serif;
            text-align: center;
            color: #2d3748;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
            position: relative;
        }
        .poem-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 2px;
            background-color: #4a90e2;
        }
        /* Mobile-specific styles */
        @media (max-width: 640px) {
            .poem-container {
                padding: 12px;
            }
            .verse {
                padding: 6px;
                margin-bottom: 10px;
            }
            .verse p {
                font-size: 0.95rem;
            }
            .tts-controls label {
                font-size: 0.85rem;
            }
            .tts-warning {
                font-size: 0.8rem;
                padding: 6px;
            }
            .dropdown select {
                font-size: 0.9rem;
            }
            .progress-bar {
                height: 6px;
            }
            h1 {
                font-size: 1.5rem;
            }
            h2 {
                font-size: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const poems = [
            // قصائد الحفظ
            {
                title: "داعية السلام (زهير بن أبي سلمى)",
                category: "حفظ",
                verses: [
                    "فَأَقْسَمْتُ بِالْبَيْتِ الَّذِي طَافَ حَوْلَهُ * رِجَالٌ بَنَوْهُ مِنْ قُرَيْشٍ وَجُرْهُمِ",
                    "يَمِينًا لَنِعْمَ السَّيِّدَانِ وُجِدْتُمَا * عَلَى كُلِّ حَالٍ مِنْ سَحِيلٍ وَمُبْرَمِ",
                    "تَدَارَكْتُمَا عَبْسًا وَدُبْيَانَ بَعْدَمَا * تَفَانَوْا وَدَقُّوا بَيْنَهُمْ عِطْرَ مَنْشَمِ",
                    "وَقَدْ قُلْتُمَا إِنْ نُدْرِكِ السِّلْمَ وَاسِعًا * بِمَالٍ وَمَعْرُوفٍ مِنَ الأَمْرِ نَسْلَمِ",
                    "أَلَا أَبْلِغِ الْأَحْلَافَ عَنِّي رِسَالَةً * وَدُبْيَانَ هَلْ أَقْسَمْتُمُ كُلَّ مُقْسَمِ",
                    "وَمَا الْحَرْبُ إِلَّا مَا عَلِمْتُمْ وَذُقْتُمُ * وَمَا هُوَ عَنْهَا بِالْحَدِيثِ الْمُرَجَّمِ",
                    "مَتَى تَبْعَثُوهَا تَبْعَثُوهَا ذَمِيمَةً * وَتَضْرَ إِذَا ضَرَّيْتُمُوهَا فَتَضْرَمِ",
                    "فَتَعْرُكْكُمُ عَرْكَ الرَّحَى بِثِفَالِهَا * وَتَلْقَحْ كِشَافًا ثُمَّ تُنْتَجْ فَتُتْئِمِ",
                    "فَتُنْتَجْ لَكُمْ غِلْمَانَ أَشْأَمَ كُلُّهُمْ * كَأَحْمَرِ عَادٍ ثُمَّ تُرْضِعْ فَتَفْطِمِ",
                    "فَتُغْلِلْ لَكُمْ مَا لَا تُغِلُّ لِأَهْلِهَا * قُرًى بِالْعِرَاقِ مِنْ قَفِيزٍ وَدِرْهَمِ"
                ]
            },
            {
                title: "فارس بني عبس (عنترة بن شداد)",
                category: "حفظ",
                verses: [
                    "إِنْ تُغْدِفِي دُونِيَ الْقِنَاعَ فَإِنَّنِي * طَبٌّ بِأَخْذِ الْفَارِسِ الْمُسْتَلْئِمِ",
                    "أَثْنِي عَلَيَّ بِمَا عَلِمْتِ، فَإِنَّنِي * سَمْحٌ مُخَالَقَتِي، إِذَا لَمْ أُظْلَمِ",
                    "فَإِذَا ظُلِمْتُ فَإِنَّ ظُلْمِي بَاسِلٌ * مُرٌّ مَذَاقَتُهُ كَطَعْمِ الْعَلْقَمِ",
                    "هَلَّا سَأَلْتِ الْخَيْلَ يَا ابْنَةَ مَالِكٍ * إِنْ كُنْتِ جَاهِلَةً بِمَا لَمْ تَعْلَمِي",
                    "إِذْ لَا أَزَالُ عَلَى رِحَالَةِ سَابِحٍ * نَهْدٍ، تُعَاوِرُهُ الْكُمَاةُ مُكَلَّمِ",
                    "طَوْرًا يُجَرَّدُ لِلطِّعَانِ وَتَارَةً * يَأْوِي إِلَى حَصِدِ الْقِسِيِّ عَرَمْرَمِ",
                    "يُخْبِرْكِ مَنْ شَهِدَ الْوَقِيعَةَ أَنَّنِي * أَغْشَى الْوَغَى، وَأَعِفُّ عِنْدَ الْمَغْنَمِ",
                    "وَمُدَجَّجٍ كَرِهَ الْكُمَاةُ نِزَالَهُ * لَا مُمْعِنٍ، هَرَبًا وَلَا مُسْتَسْلِمِ",
                    "جَادَتْ لَهُ كَفِّي بِعَاجِلِ طَعْنَةٍ * بِمُثَقَّفٍ صَدْقِ الْكُعُوبِ مُقَوَّمِ",
                    "بِرَحِيبَةِ الْفَرْغَيْنِ يَهْدِي جَرْسُهَا * بِاللَّيْلِ مُعْتَسَّ الذِّئَابِ الضُّرَّمِ"
                ]
            },
            {
                title: "قيم ومثل (لبيد بن ربيعة العامري)",
                category: "حفظ",
                verses: [
                    "إِذَا الْمَرْءُ لَمْ يَدْنَسْ مِنَ اللُّؤْمِ عِرْضُهُ * فَكُلُّ رِدَاءٍ يَرْتَدِيهِ جَمِيلُ",
                    "وَإِنْ هُوَ لَمْ يَحْمِلْ عَلَى النَّفْسِ ضَيْمَهَا * فَلَيْسَ إِلَى حُسْنِ الثَّنَاءِ سَبِيلُ",
                    "تُعَيِّرُنَا أَنَّا قَلِيلٌ عَدِيدُنَا * فَقُلْتُ لَهَا إِنَّ الْكِرَامَ قَلِيلُ",
                    "وَمَا قَلَّ مَنْ كَانَتْ بَقَايَاهُ مِثْلَنَا * شَبَابٌ تَسَامَى لِلْعُلَا وَكُهُولُ",
                    "وَمَا ضَرَّنَا أَنَّا قَلِيلٌ وَجَارُنَا * عَزِيزٌ وَجَارُ الْأَكْثَرِينَ ذَلِيلُ",
                    "لَنَا جَبَلٌ يَحْتَلُّهُ مَنْ نُجِيرُهُ * مَنِيعٌ يَرُدُّ الطَّرْفَ وَهُوَ كَلِيلُ",
                    "يُقَرِّبُ حُبُّ الْمَوْتِ آجَالَنَا لَنَا * وَتَكْرَهُهُ آجَالُهُمْ فَتَطُولُ",
                    "وَمَا مَاتَ مِنَّا سَيِّدٌ حَتْفَ أَنْفِهِ * وَلَا طُلَّ مِنَّا حَيْثُ كَانَ قَتِيلُ",
                    "تَسِيلُ عَلَى حَدِّ الظُّبَاتِ نُفُوسُنَا * وَلَيْسَتْ عَلَى غَيْرِ الظُّبَاتِ تَسِيلُ",
                    "وَتُنْكِرُ إِنْ شِئْنَا عَلَى النَّاسِ قَوْلَهُمْ * وَلَا يُنْكِرُونَ الْقَوْلَ حِينَ نَقُولُ",
                    "إِذَا سَيِّدٌ مِنَّا خَلَا قَامَ سَيِّدٌ * قَؤُولٌ لِمَا قَالَ الْكِرَامُ فَعُولُ",
                    "وَمَا أُخْمِدَتْ نَارٌ لَنَا دُونَ طَارِقٍ * وَلَا ذَمَّنَا فِي النَّازِلِينَ نَزِيلُ",
                    "سَلِي إِنْ جَهِلْتِ النَّاسَ عَنَّا وَعَنْهُمُ * فَلَيْسَ سَوَاءً عَالِمٌ وَجَهُولُ"
                ]
            },
            {
                title: "يوم الفرقان (حسان بن ثابت)",
                category: "حفظ",
                verses: [
                    "عَرَفْتُ دِيَارَ زَيْنَبَ بِالْكَثِيبِ * كَخَطِّ الْوَحْيِ فِي الرَّقِّ الْقَشِيبِ",
                    "فَدَعْ عَنْكَ التَّذَكُّرَ كُلَّ يَوْمٍ * وَرُدَّ حَرَارَةَ الصَّدْرِ الْكَئِيبِ",
                    "وَخَبِّرْ بِالَّذِي لَا عَيْبَ فِيهِ * بِصِدْقٍ، غَيْرَ إِخْبَارِ الْكَذُوبِ",
                    "بِمَا صَنَعَ الْمَلِيكُ غَدَاةَ بَدْرٍ * لَنَا فِي الْمُشْرِكِينَ مِنَ النَّصِيبِ",
                    "غَدَاةَ كَأَنَّ جَمْعَهُمُ حِرَاءٌ * بَدَتْ أَرْكَانُهُ جُنْحَ الْغُرُوبِ",
                    "فَلَاقَيْنَاهُمُ مِنَّا بِجَمْعٍ * كَأُسْدِ الْغَابِ: مُرْدَانٍ وَشِيبِ",
                    "أَمَامَ مُحَمَّدٍ قَدْ آزَرُوهُ * عَلَى الْأَعْدَاءِ فِي رَهَجِ الْحُرُوبِ",
                    "فَعَادَرَا أَبَا جَهْلٍ صَرِيعًا * وَعُتْبَةَ قَدْ تَرَكْنَا فِي الْجَبُوبِ",
                    "وَشَيْبَةَ قَدْ تَرَكْنَا فِي رِجَالٍ * ذَوِي حَسَبٍ، إِذَا نُسِبُوا، حَسِيبِ",
                    "يُنَادِيهِمْ رَسُولُ اللَّهِ لَمَّا * قَذَفْنَاهُمْ كَبَاكِبَ فِي الْقَلِيبِ",
                    "أَلَمْ تَجِدُوا حَدِيثِي كَانَ حَقًّا * وَأَمْرُ اللَّهِ يَأْخُذُ بِالْقُلُوبِ"
                ]
            },
            {
                title: "علمت نفسي مكان دوائيا (قيس بن الملوح العامري)",
                category: "حفظ",
                verses: [
                    "أَلَا يَا حَمَامَيْ بَطْنِ وَدَّانَ هِجْتُمَا * عَلَيَّ الْهَوَى لَمَّا تَغَنَّيْتُمَا لِيَا",
                    "فَأَبْكَيْتُمَانِي وَسْطَ أَهْلِي وَلَمْ أَكُنْ * أُبَالِي دُمُوعَ الْعَيْنِ لَوْ كُنْتُ خَالِيَا",
                    "أَلَا أَيُّهَا الرَّكْبُ الْيَمَانُونَ عَرِّجُوا * عَلَيْنَا فَقَدْ أَضْحَى هَوَايَ يَمَانِيَا",
                    "نُسَائِلُكُمْ هَلْ سَالَ نُعْمَانُ بَعْدَنَا * وَحُبَّ إِلَيْنَا بَطْنُ نُعْمَانَ وَادِيَا",
                    "أَعُدُّ اللَّيَالِي لَيْلَةً بَعْدَ لَيْلَةٍ * وَقَدْ عِشْتُ دَهْرًا لَا أَعُدُّ اللَّيَالِيَا",
                    "تَمُرُّ اللَّيَالِي وَالشُّهُورُ وَتَنْقَضِي * وَحُبُّكِ مَا يَزْدَادُ إِلَّا تَمَادِيَا",
                    "خَلِيلَيَّ إِنْ دَارَتْ عَلَى أُمِّ مَالِكٍ * صُرُوفُ اللَّيَالِي فَابْغِيَا لِيَ نَاعِيَا",
                    "خَلِيلَيَّ لَا وَاللَّهِ لَا أَمْلِكُ الَّذِي * قَضَى اللَّهُ فِي لَيْلَى وَلَا مَا قَضَى لِيَا",
                    "قَضَاهَا لِغَيْرِي وَابْتَلَانِي بِحُبِّهَا * فَهَلَّا بِشَيْءٍ غَيْرِ لَيْلَى ابْتَلَانِيَا",
                    "أَمَضْرُوبَةٌ لَيْلَى عَلَى أَنْ أَزُورَهَا * وَمُتَّخِذٌ ذَنْبًا لَهَا أَنْ تَرَانِيَا",
                    "وَلَوْ كَانَ وَاشٍ بِالْيَمَامَةِ دَارُهُ * وَدَارِي بِأَعْلَى حَضْرَمَوْتَ اهْتَدَى لِيَا",
                    "وَإِنِّي لَأَخْشَى أَنْ أَمُوتَ فَجَاءَةً * وَفِي النَّفْسِ حَاجَاتٌ إِلَيْكِ كَمَا هِيَا",
                    "وَإِنِّي لَيُثْنِينِي لِقَاؤُكِ كُلَّمَا * لَقِيتُكِ يَوْمًا أَنْ أَبُثَّكِ مَا بِيَا",
                    "وَقَالُوا بِهِ دَاءٌ عُيَاءٌ أَصَابَهُ * وَقَدْ عَلِمَتْ نَفْسِي مَكَانَ دَوَائِيَا"
                ]
            },
            {
                title: "في النفس حاجات (جميل بن معمر)",
                category: "حفظ",
                verses: [
                    "وَمَا زِلْتُمُ يَا بُثْنَ حَتَّى لَوَ اَنَّنِي * مِنَ الشَّوْقِ أَسْتَبْكِي الْحَمَامَ بَكَى لِيَا",
                    "إِذَا حَدَرَتْ رِجْلِي وَقِيلَ شِفَاؤُهَا * دُعَاءُ حَبِيبٍ كُنْتِ أَنْتِ دُعَائِيَا",
                    "وَمَا زَادَنِي الْوَاشُونَ إِلَّا صَبَابَةً * وَلَا طُولُ اجْتِمَاعِ تَقَالِيَا",
                    "وَلَا زَادَنِي الْوَاشُونَ إِلَّا كَآبَةً * وَلَا كَثْرَةُ النَّاهِينَ إِلَّا تَمَادِيَا",
                    "وَأَنْتِ الَّتِي إِنْ شِئْتِ كَدَّرْتِ عِيشَتِي * وَإِنْ شِئْتِ بَعْدَ اللَّهِ أَنْعَمْتِ بَالِيَا",
                    "وَأَنْتِ الَّتِي مَا مِنْ صَدِيقٍ وَلَا عِدًى * يَرَى نُضْوَ مَا أَبْقَيْتِ إِلَّا رَثَى لِيَا",
                    "لَقَدْ خِفْتُ أَنْ أَلْقَى الْمَنِيَّةَ بَغْتَةً * وَفِي النَّفْسِ حَاجَاتٌ إِلَيْكِ كَمَا هِيَا"
                ]
            },
            // قصائد الشرح
            {
                title: "كيف لي بالصبر (برة بنت الحارث)",
                category: "شرح",
                verses: [
                    "يَا عَمْرُو مَالِي عَنْكَ مِنْ صَبْرِ * يَا عَمْرُو يَا أَسَفَا عَلَى عَمْرُو",
                    "لِلَّهِ ، يَا عَمْرُو، وَإِنِّي فَتًى * كُفِّنْتُ ثُمَّ وُضِعْتُ فِي الْقَبْرِ",
                    "أَحْثُوا التُّرَابَ عَلَى مَفَارِقِهِ * وَعَلَى غُرَارَةِ وَجْهِهِ النَّضْرِ",
                    "حِينَ اسْتَوَى وَعَلَا الشَّبَابُ بِهِ * وَبَدَا مُنِيرَ الْوَجْهِ كَالْبَدْرِ",
                    "وَأَقَامَ مُنْطَلِقًا فَأَكْثَبَهُ * وَرَوَى وَجَالَسَ كُلَّ ذِي حِجْرِ",
                    "وَرَمَى فَأَرْسَلَ مَنَاطِعًا * وَرَأَى شَقَاءَ مَنَاجِدٍ تَجْرِي",
                    "ثُمَّ لَمْ يَجِدْهُ فَسَاوَرَهُ * وَجَدًا مَعَ الْخَادِينَ فِي الْمَأْثِرِ",
                    "تَنَبَّأَ الْخِبَارُ بِهِ، وَتَقَدَّمَهَا * قَلَحٌ يُقَلِّبُ مَقْلَتَيْ صَقْرِ",
                    "زَبَيْتُهُ عَصْرًا أَفَتْقَتْهُ * فِي الْبَحْرِ أَغْدُوهُ وَفِي الْعَصْرِ",
                    "أَبَنِيَّ الرِّوَاقَ عَلَى أَرِيكَتِهِ * لِيُقِيلَ دُونَ الشَّمْسِ فِي سِتْرِ",
                    "قَدْ رَاعَنِي صَوْتٌ نَبِهْتُ لَهُ * وَذَعَرَتْ مِنْهُ أَيَّمَا ذُعْرِ",
                    "فَإِذَا مُلِيتُهُ مُسْتَأْسِرُهُ * قَدْ كَدَحَتْ فِي الْوَجْهِ وَالنَّحْرِ",
                    "وَالْمَوْتُ يَقْبِضُهُ وَيَبْسُطُهُ * كَالثَّوْبِ عِنْدَ الطَّيِّ وَالنَّشْرِ",
                    "كَيْفَ التَّعَزِّي عَنْكَ يَا عَمْرُو * أَمْ كَيْفَ لِي يَا عَمْرُو بِالصَّبْرِ"
                ]
            },
            {
                title: "لم يك وقافا (دريد بن الصمة)",
                category: "شرح",
                verses: [
                    "أَعَاذِلُ إِنَّ الرُّزْءَ فِي مِثْلِ خَالِدٍ * وَلَا رُزْءَ فِيمَا أَهْلَكَ الْمَرْءُ عَنْ يَدِ",
                    "وَقُلْتُ لِمَارِضٍ وَأَصْحَابِ عَارِضٍ * وَرَهْطِ بَنِي السَّوْدَاءِ وَالْقَوْمِ شُهَّدِي",
                    "عَلَانِيَةً ظَنُّوا بِأَلْفَيْ مُدَجَّجٍ * سَرَاتُهُمُ فِي الْفَارِسِيِّ الْمُسَرَّدِ",
                    "وَلَمَّا رَأَيْتُ الْخَيْلَ قُبْلًا كَأَنَّهَا * جَرَادٌ يُبَارِي وَجْهَةَ الرِّيحِ مُغْتَدِي",
                    "أَمَرْتُهُمُ أَمْرِي بِمُنْعَرَجِ اللِّوَى * فَلَمْ يَسْتَبِينُوا النُّصْحَ إِلَّا ضُحَى الْغَدِ",
                    "فَلَمَّا عَصَوْنِي كُنْتُ مِنْهُمْ وَقَدْ أَرَى * غِوَايَتَهُمُ وَالَّتِي غَيْرُ مُهْتَدِي",
                    "وَمَا أَنَا إِلَّا مِنْ غَزِيَّةَ إِنْ غَوَتْ * غَوَيْتُ وَإِنْ تَرْشُدْ غَزِيَّةُ أَرْشُدِ",
                    "دَعَانِي أَخِي وَالْخَيْلُ بَيْنِي وَبَيْنَهُ * فَلَمَّا دَعَانِي لَمْ يَجِدْنِي بِقُعْدَدِ",
                    "فَجِئْتُ إِلَيْهِ وَالرِّمَاحُ تَنُوشُهُ * كَوَقْعِ الصَّيَاصِي فِي النَّسِيجِ الْمُمَدَّدِ",
                    "فَطَاعَنْتُ عَنْهُ الْخَيْلَ حَتَّى تَنَفَّسَتْ * وَحَتَّى عَلَانِي كُلُّ أَشْقَرَ مُزْبِدِ",
                    "طِعَانَ امْرِئٍ آسَى أَخَاهُ بِنَفْسِهِ * وَيَعْلَمُ أَنَّ الْمَرْءَ غَيْرُ مُخَلَّدِ",
                    "تَنَادَوْا فَقَالُوا أَرْدَتِ الْخَيْلُ فَارِسًا * فَقُلْتُ : أَعَبْدُ اللَّهِ ذَلِكُمُ الرَّدِي ؟",
                    "فَإِنْ يَكُ عَبْدُ اللَّهِ خَلَّى مَكَانَهُ * فَمَا كَانَ وَقَّافًا وَلَا طَائِشَ الْيَدِ",
                    "كَمِيشُ الْإِزَارِ خَارِجٌ نِصْفَ سَاقِهِ * صَبُورٌ عَلَى الْعَزَّاءِ طَلَّاعُ أَنْجُدِ",
                    "تَرَى خِصَبَ الْبِيضِ وَالزَّادَ حَاضِرٌ * عِنْدَ وَيُعْتَدُو فِي الْقَيْصَرِ الْمُقَعَّدِ",
                    "وَإِنْ مَسَّهُ الْإِقْوَاءُ وَالْجَهْدُ زَادَهُ * سَمَاحًا وَإِتْلَافًا لِمَا كَانَ فِي الْيَدِ",
                    "وَغَارَهُ بَيْنَ الْيَوْمِ وَالْأَمْسِ فِتْنَةٌ * فَأَرْكَبَهَا رَكْضًا بِسَيْفٍ مُهَنَّدِ",
                    "سَلِيمُ الشَّظَا عَبْلُ الشَّوَى شَنِجُ النَّسَا * طَوِيلُ الْقَرَا لَهْدٌ أَسِيلُ الْمُقَلَّدِ",
                    "يَمُوتُ طَوِيلُ الْقَوْمِ عِقْدُ عِذَارِهِ * مَلِيثٌ كَجِذْعِ النَّخْلَةِ الْمُتَجَرِّدِ",
                    "وَهَوْنٍ وَجَدِّي الَّتِي لَمْ أَقُلْ لَهُ * كَذَبْتَ وَلَمْ أَبْخَلْ بِمَا مَلَكَتْ يَدِي"
                ]
            },
            {
                title: "هم الأنصار (كعب بن زهير)",
                category: "شرح",
                verses: [
                    "مَنْ سَرَّهُ كَرَمُ الْحَيَاةِ فَلَا يَزَلْ * فِي مِقْنَبٍ مِنْ صَالِحِي الْأَنْصَارِ",
                    "تَرِثُ الْجِبَالَ رَزَانَةً أَحْلَامُهُمْ * وَأَكُفُّهُمْ خَلَفٌ مِنَ الْأَمْطَارِ",
                    "الْمُكْرِهِينَ السُّمْهَرِيَّ بِأَذْرُعٍ * كَصَوَاقِلِ الْهِنْدِيِّ غَيْرَ قِصَارِ",
                    "وَالنَّاظِرِينَ بِأَعْيُنٍ مُحْمَرَّةٍ * كَالْجَمْرِ غَيْرَ كَلِيلَةِ الْأَبْصَارِ",
                    "وَالنَّازِلِينَ النَّاسَ عَنْ أَدْيَانِهِمْ * بِالْمُشْرِفِيِّ وَبِالْقَنَا الْخَطَّارِ",
                    "وَالْبَاذِلِينَ نُفُوسَهُمْ لِنَبِيِّهِمْ * يَوْمَ الْهِيَاجِ وَفِتْنَةَ الْجَبَّارِ",
                    "دَرَبُوا كَمَا دَرِبَتْ أُسُودُ حَفِيَّةٍ * عَادٍ الرِّقَابِ مِنَ الْأُسُودِ ضَوَارِي",
                    "وَهُمُ إِذَا خَوَتِ النُّجُومُ وَأَمْحَلُوا * لِلطَّائِفِينَ السَّائِلِينَ مَقَارِي"
                ]
            },
            {
                title: "في الفخر والمدح (النابغة الجعدي)",
                category: "شرح",
                verses: [
                    "خَلِيلَيَّ، عُوجَا سَاعَةً، وَتَهَجَّرَا * وَلُومَا عَلَى مَا أَحْدَثَ الدَّهْرُ، أَوْ ذَرَا",
                    "وَلَا تَجْزَعَا إِنَّ الْحَيَاةَ مُشِمَّةٌ * شَقَاءً لِرَوْعَاتِ الْحَوَادِثِ، أَوْ قِرَا",
                    "وَإِنْ جَاءَ أَمْرٌ لَا تُطِيقَانِ دَفْعَهُ * فَلَا تَجْزَعَا مِمَّا قَضَى اللَّهُ، وَاصْبِرَا",
                    "أَلَمْ تَرَيَا أَنَّ الْمَلَامَةَ نَفْعُهَا * قَلِيلٌ، إِذَا مَا الشَّيْءُ، وَلَّى فَأَدْبَرَا",
                    "تُهِيجُ الْبُكَاءَ الْمَلَامَةُ، ثُمَّ لَا * تُغَيِّرُ شَيْئًا، غَيْرَ كَلَامٍ، فَقَدْ مَرَا",
                    "أَتَيْتُ رَسُولَ اللَّهِ، إِذْ جَاءَ بِالْهُدَى * وَيَتْلُو كِتَابًا كَالْمَجَرَّةِ، نَيِّرَا",
                    "وَجَاهَدْتُ حَتَّى مَا أُجِنُّ وَمِنْ مَعِي * سُهَيْلًا إِذَا مَا لَاحَ ثُمَّتَ غَوَّرَا",
                    "أُقِيمُ عَلَى التَّقْوَى وَأَرْضَى بِفِعْلِهَا * وَكُنْتُ مِنَ النَّارِ الْمَخُوفَةِ أَحْذَرَا",
                    "وَإِنَّا لَقَوْمٌ مَا نُعَوِّدُ خَيْلَنَا * إِذَا مَا الْتَقَيْنَا أَنْ تَحِيدَ وَتَنْفِرَا",
                    "وَنُنْكِرُ يَوْمَ الرَّوْعِ أَلْوَانَ خَيْلِنَا * مِنَ الطَّعْنِ حَتَّى نَحْسَبَ الْجَوْنَ أَشْقَرَا",
                    "بَلَغْنَا السَّمَاءَ مَجْدَنَا وَجُدُودَنَا * وَإِنَّا لَنَرْجُو بَعْدَ ذَلِكَ مَظْهَرَا",
                    "وَلَا خَيْرَ فِي حِلْمٍ إِذَا لَمْ تَكُنْ لَهُ * بَوَادِرُ تَحْمِي صَفْوَهُ أَنْ يُكَدَّرَا",
                    "وَلَا خَيْرَ فِي جَهْلٍ إِذَا لَمْ يَكُنْ لَهُ * حَلِيمٌ إِذَا مَا أَوْرَدَ الْأَمْرَ أَصْدَرَا"
                ]
            },
            {
                title: "جرير يمدح عبد الملك بن مروان (جرير بن عطية)",
                category: "شرح",
                verses: [
                    "أَتَصْحُو بَلْ فُؤَادُكَ غَيْرُ صَاحِ * عَشِيَّةَ هَمَّ صَحْبُكَ بِالرَّوَاحِ",
                    "تَقُولُ الْعَاذِلَاتُ عَلَاكَ شَيْبٌ * أَهَذَا الشَّيْبُ يَمْنَعُنِي مِرَاحِي؟",
                    "تَعَزَّتْ أُمُّ حَزْرَةَ ثُمَّ قَالَتْ * رَأَيْتُ الْمُورِدِينَ ذَوِي لِقَاحِ",
                    "نُمِلُّ وَهِيَ سَاعِيَةٌ بَنِيهَا * بِأَنْفَاسٍ مِنَ الشَّبَمِ الْقَرَاحِ",
                    "سَأَمْتَاحُ الْبُحُورَ فَجَنِّبِينِي * أَذَاةَ اللَّوْمِ وَانْتَظِرِي امْتِيَاحِي",
                    "نَفَى بِاللَّهِ لَيْسَ لَهُ شَرِيكٌ * وَمَنْ عِنْدَ الْخَلِيفَةِ بِالنَّجَاحِ",
                    "أَغِثْنِي، يَا فِدَاكَ أَبِي وَأُمِّي * بِسَيْبٍ مِنْكَ إِنَّكَ ذُو ارْتِيَاحِ",
                    "سَأَشْكُرُ أَنْ رَدَدْتَ عَلَيَّ رِيشِي * وَأَثْبَتَّ الْقَوَادِمَ فِي جَنَاحِي",
                    "أَلَسْتُمْ خَيْرَ مَنْ رَكِبَ الْمَطَايَا * وَأَنْدَى الْعَالَمِينَ بُطُونَ رَاحِ"
                ]
            },
            // الرسائل
            {
                title: "كتاب عمر بن الخطاب إلى أبي موسى الأشعري (في القضاء)",
                category: "رسائل",
                verses: [
                    "بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيمِ مِنْ عَبْدِ اللَّهِ عُمَرَ بْنِ الْخَطَّابِ أَمِيرِ الْمُؤْمِنِينَ إِلَى عَبْدِ اللَّهِ بْنِ قَيْسٍ – سَلَامٌ عَلَيْكَ أَمَّا بَعْدُ فَإِنَّ الْقَضَاءَ فَرِيضَةٌ مُحْكَمَةٌ وَسُنَّةٌ مُتَّبَعَةٌ ، فَافْهَمْ إِذَا أُدْلِيَ إِلَيْكَ ، وَانْفِذْ إِذَا تَبَيَّنَ لَكَ فَإِنَّهُ لَا يَنْفَعُ تَكَلُّمٌ بِحَقٍّ لَا نَفَاذَ لَهُ ، آسِ بَيْنَ النَّاسِ فِي وَجْهِكَ وَعَدْلِكَ وَمَجْلِسِكَ حَتَّى لَا يَطْمَعَ شَرِيفٌ فِي حَيْفِكَ ، وَلَا يَيْأَسَ ضَعِيفٌ مِنْ عَدْلِكَ .",
                    "الْبَيِّنَةُ عَلَى مَنِ ادَّعَى ، وَالْيَمِينُ عَلَى مَنْ أَنْكَرَ ، وَالصُّلْحُ جَائِزٌ بَيْنَ الْمُسْلِمِينَ إِلَّا صُلْحًا أَحَلَّ حَرَامًا أَوْ حَرَّمَ حَلَالًا ، وَلَا يَمْنَعْكَ قَضَاءٌ قَضَيْتَهُ الْيَوْمَ فَرَاجَعْتَ فِيهِ عَقْلَكَ وَهُدِيتَ فِيهِ لِرُشْدِكَ أَنْ تَرْجِعَ إِلَى الْحَقِّ فَإِنَّ الْحَقَّ قَدِيمٌ وَمُرَاجَعَةُ الْحَقِّ خَيْرٌ مِنَ التَّمَادِي فِي الْبَاطِلِ .",
                    "الْفَهْمَ الْفَهْمَ فِيمَا يَخْتَلِجُ فِي صَدْرِكَ مِمَّا لَيْسَ فِي كِتَابِ اللَّهِ وَسُنَّةِ النَّبِيِّ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ ثُمَّ اعْرِفِ الْأَشْبَاهَ وَالْأَمْثَالَ ، فَقِسِ الْأُمُورَ عِنْدَ ذَلِكَ بِنَظَائِرِهَا ، وَاعْمِدْ إِلَى أَقْرَبِهَا إِلَى اللَّهِ تَعَالَى وَأَشْبَهِهَا بِالْحَقِّ ، وَاجْعَلْ لِمَنِ ادَّعَى حَقًّا غَائِبًا أَوْ بَيِّنَةً أَمَدًا يَنْتَهِي إِلَيْهِ فَإِنْ أَحْضَرَ بَيِّنَةً أَخَذْتَ لَهُ بِحَقِّهِ ، وَإِلَّا اسْتَحْلَلْتَ عَلَيْهِ الْقَضِيَّةَ فَإِنَّ ذَلِكَ أَنْفَى لِلشَّكِّ وَأَجْلَى لِلْعَمَى ، وَأَبْلَغُ فِي الْعُذْرِ .",
                    "الْمُسْلِمُونَ عُدُولٌ بَعْضُهُمْ عَلَى بَعْضٍ إِلَّا مَجْلُودًا فِي حَدٍّ ، أَوْ مُجَرَّبًا عَلَيْهِ شَهَادَةَ زُورٍ ، أَوْ ظَنِينًا فِي وَلَاءٍ أَوْ نَسَبٍ فَإِنَّ اللَّهَ قَدْ تَوَلَّى مِنْكُمْ السَّرَائِرَ ، وَدَرَأَ بِالْبَيِّنَاتِ وَالْأَيْمَانِ وَإِيَّاكَ وَالْغَضَبَ وَالْقَلَقَ وَالضَّجَرَ وَالتَّأَذِّيَ بِالْخُصُومِ ، وَالتَّنَكُّرَ عِنْدَ الْخُصُومَاتِ ، فَإِنَّ الْحَقَّ فِي مَوَاطِنِ الْحَقِّ ، يُعَظِّمُ اللَّهُ بِهِ الْأَجْرَ ، وَيُحْسِنُ عَلَيْهِ الذُّخْرَ فَمَنْ صَحَّتْ نِيَّتُهُ ، وَأَقْبَلَ عَلَى نَفْسِهِ ، كَفَاهُ اللَّهُ مَا بَيْنَهُ وَبَيْنَ النَّاسِ ، وَمَنْ تَحَلَّى لِلنَّاسِ بِمَا يَعْلَمُ اللَّهُ أَنَّهُ لَيْسَ مِنْ نَفْسِهِ ، شَانَهُ اللَّهُ ، فَمَا ظَنُّكَ بِثَوَابِ عِنْدَ اللَّهِ عَزَّ وَجَلَّ فِي عَاجِلِ رِزْقِهِ وَخَزَائِنِ رَحْمَتِهِ ، وَالسَّلَامُ ."
                ]
            }
        ];

        function Verse({ verse, index, memorized, toggleMemorized, speakVerse, isPlayingAll, settings }) {
            const [isPlaying, setIsPlaying] = React.useState(false);
            const audioRef = React.useRef(null);

            const verseStyle = {
                backgroundColor: memorized ? '#f0fff4' : settings.verseBackground,
            };

            const textStyle = {
                fontSize: `${settings.fontSize}rem`,
            };

            const handlePlayClick = async (e) => {
                e.stopPropagation();
                if (isPlaying) {
                    if (audioRef.current) {
                        audioRef.current.stop();
                        audioRef.current = null;
                    }
                    setIsPlaying(false);
                } else {
                    setIsPlaying(true);
                    try {
                        await speakVerse(verse, setIsPlaying, audioRef);
                    } catch (error) {
                        console.error('Error playing verse:', error);
                        setIsPlaying(false);
                    }
                }
            };

            React.useEffect(() => {
                return () => {
                    if (audioRef.current) {
                        audioRef.current.stop();
                        audioRef.current = null;
                    }
                };
            }, []);

            return (
                <div className={`verse ${memorized ? 'memorized' : ''}`} style={verseStyle}>
                    <div className="flex flex-col gap-4">
                        <p className="text-center" style={textStyle}>{verse}</p>
                        <div className="flex justify-center space-x-3">
                            <button
                                onClick={handlePlayClick}
                                className={`px-4 py-2 ${isPlaying ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-500 hover:bg-blue-600'} text-white rounded-lg transition-colors duration-200`}
                                disabled={isPlayingAll}
                            >
                                {isPlaying ? 'إيقاف' : 'تشغيل الصوت'}
                            </button>
                            <button
                                onClick={(e) => { e.stopPropagation(); toggleMemorized(index); }}
                                className={`px-4 py-2 ${memorized ? 'bg-green-600' : 'bg-green-500'} text-white rounded-lg hover:bg-green-600 transition-colors duration-200`}
                            >
                                {memorized ? 'إلغاء الحفظ' : 'تم الحفظ'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function Poem({ poem, memorizedVerses, updateMemorizedState, settings }) {
            const [ttsRate, setTtsRate] = React.useState(1.0);
            const [wordDelay, setWordDelay] = React.useState(0);
            const [isPlayingAll, setIsPlayingAll] = React.useState(false);
            const [currentAudio, setCurrentAudio] = React.useState(null);
            const timeoutRef = React.useRef(null);
            const isMounted = React.useRef(true);
            const allAudioRefs = React.useRef([]);

            React.useEffect(() => {
                return () => {
                    isMounted.current = false;
                    stopPlayback();
                };
            }, []);

            // تعريف وظيفة الإيقاف القسري عالمياً 
            React.useEffect(() => {
                window.emergencyAudioStop = function() {
                    console.log("EMERGENCY AUDIO STOP ACTIVATED");
                    
                    // إيقاف جميع المؤقتات
                    clearTimeout(timeoutRef.current);
                    timeoutRef.current = null;
                    
                    // إيقاف جميع عناصر الصوت في الصفحة
                    document.querySelectorAll('audio').forEach(audio => {
                        try {
                            audio.pause();
                            audio.src = '';
                            audio.remove();
                        } catch (e) {}
                    });
                    
                    // إعادة تعيين المتغيرات
                    allAudioRefs.current = [];
                    if (currentAudio) {
                        try {
                            currentAudio.pause();
                            currentAudio.src = '';
                        } catch (e) {}
                        setCurrentAudio(null);
                    }
                    
                    setIsPlayingAll(false);
                    
                    // أسلوب أكثر عدوانية لإيقاف الصوت: إعادة تهيئة نظام الصوت
                    try {
                        // إعادة تهيئة نظام الصوت بإضافة وإزالة iframe
                        const frame = document.createElement('iframe');
                        frame.style.display = 'none';
                        document.body.appendChild(frame);
                        setTimeout(() => {
                            document.body.removeChild(frame);
                        }, 100);
                    } catch (e) {}
                };
                
                return () => {
                    delete window.emergencyAudioStop;
                };
            }, []);

            const stopPlayback = () => {
                // استخدام وظيفة الإيقاف القسري
                if (window.emergencyAudioStop) {
                    window.emergencyAudioStop();
                }
            };
            
            // طريقة جديدة تماماً لتشغيل الكلمات مع دعم أفضل للتأخير
            const speakText = async (text, rate, delayAfter = 0) => {
                return new Promise((resolve, reject) => {
                    // تنظيف النص وتحسين النطق
                    let processedText = text;
                    if (text.includes("عمرو")) {
                        processedText = text.replace(/عمرو/g, "عَمْرُو");
                    }
                    
                    console.log(`Playing: "${processedText}" with rate ${rate}, delay after: ${delayAfter}ms`);
                    
                    // إنشاء عنصر الصوت
                    const audio = new Audio();
                    // تحديد هوية فريدة للصوت
                    audio.id = 'tts-audio-' + Date.now();
                    audio.className = 'tts-audio';
                    audio.src = `https://translate.google.com/translate_tts?ie=UTF-8&tl=ar&client=tw-ob&q=${encodeURIComponent(processedText)}`;
                    audio.playbackRate = rate;
                    
                    // تخزين مرجع الصوت للتمكن من إيقافه لاحقاً
                    allAudioRefs.current.push(audio);
                    setCurrentAudio(audio);
                    
                    // إضافة معالجات الأحداث
                    const handleEnded = async () => {
                        audio.removeEventListener('ended', handleEnded);
                        
                        // إزالة من قائمة المراجع
                        const index = allAudioRefs.current.indexOf(audio);
                        if (index > -1) {
                            allAudioRefs.current.splice(index, 1);
                        }
                        
                        // تنفيذ التأخير إذا كان مطلوباً
                        if (delayAfter > 0 && isMounted.current) {
                            await new Promise(innerResolve => {
                                timeoutRef.current = setTimeout(innerResolve, delayAfter);
                            });
                        }
                        
                        // إكمال الوعد
                        resolve();
                    };
                    
                    const handleError = (e) => {
                        console.error("Audio playback error:", e);
                        audio.removeEventListener('error', handleError);
                        
                        // إزالة من قائمة المراجع
                        const index = allAudioRefs.current.indexOf(audio);
                        if (index > -1) {
                            allAudioRefs.current.splice(index, 1);
                        }
                        
                        reject(e);
                    };
                    
                    // إضافة المستمعين
                    audio.addEventListener('ended', handleEnded);
                    audio.addEventListener('error', handleError);
                    
                    // تشغيل الصوت
                    audio.play().catch(e => {
                        handleError(e);
                    });
                });
            };
            
            // دالة جديدة لتشغيل بيت كامل
            const speakVerse = async (verse, setVerseIsPlaying) => {
                // تجنب التشغيل إذا كان هناك تشغيل للكل
                if (isPlayingAll) return;
                
                // إيقاف أي صوت قيد التشغيل
                stopPlayback();
                
                // تعيين حالة التشغيل
                setVerseIsPlaying(true);
                
                try {
                    // إذا كان هناك تأخير بين الكلمات، نشغل كلمة كلمة
                    if (wordDelay > 0) {
                        const words = verse.split(' ').filter(word => word.trim());
                        
                        for (let i = 0; i < words.length; i++) {
                            // التحقق من أن المكون لا يزال مثبتاً
                            if (!isMounted.current) break;
                            
                            // تشغيل الكلمة
                            const isLastWord = i === words.length - 1;
                            const delay = isLastWord ? 0 : wordDelay;
                            await speakText(words[i], ttsRate, delay);
                        }
                    } else {
                        // تشغيل البيت كاملاً كدفعة واحدة
                        await speakText(verse, ttsRate);
                    }
                } catch (error) {
                    console.error('Error in speakVerse:', error);
                } finally {
                    // إعادة تعيين حالة التشغيل إذا كان المكون لا يزال مثبتاً
                    if (isMounted.current) {
                        setVerseIsPlaying(false);
                    }
                }
            };
            
            // دالة جديدة لتشغيل جميع الأبيات
            const speakAllVerses = async () => {
                // إذا كان التشغيل جاري، نقوم بإيقافه
                if (isPlayingAll) {
                    stopPlayback();
                    return;
                }
                
                // تعيين حالة تشغيل الكل
                setIsPlayingAll(true);
                
                try {
                    for (let i = 0; i < poem.verses.length; i++) {
                        // التحقق من أن المكون لا يزال مثبتاً وأن حالة تشغيل الكل لا تزال نشطة
                        if (!isMounted.current || !isPlayingAll) break;
                        
                        const verse = poem.verses[i];
                        
                        // تشغيل البيت الحالي حسب إعداد التأخير
                        if (wordDelay > 0) {
                            const words = verse.split(' ').filter(word => word.trim());
                            
                            for (let j = 0; j < words.length; j++) {
                                // التحقق مرة أخرى من الحالة
                                if (!isMounted.current || !isPlayingAll) break;
                                
                                // تشغيل الكلمة
                                const isLastWord = j === words.length - 1;
                                const delay = isLastWord ? 0 : wordDelay;
                                await speakText(words[j], ttsRate, delay);
                            }
                        } else {
                            // تشغيل البيت كاملاً
                            await speakText(verse, ttsRate);
                        }
                        
                        // تأخير بين الأبيات (إلا إذا كان هذا هو البيت الأخير)
                        if (i < poem.verses.length - 1 && isMounted.current && isPlayingAll) {
                            await new Promise(resolve => {
                                timeoutRef.current = setTimeout(resolve, 1500);
                            });
                        }
                    }
                } catch (error) {
                    console.error('Error in speakAllVerses:', error);
                } finally {
                    // إعادة تعيين حالة تشغيل الكل إذا كان المكون لا يزال مثبتاً
                    if (isMounted.current) {
                        setIsPlayingAll(false);
                    }
                }
            };

            // إضافة useEffect لإيقاف التشغيل عند تغيير القصيدة
            React.useEffect(() => {
                stopPlayback();
            }, [poem]);

            const toggleMemorized = (index) => {
                updateMemorizedState(poem.title, index, !memorizedVerses[index]);
            };

            const memorizedCount = memorizedVerses.filter(Boolean).length;
            const progress = (memorizedCount / poem.verses.length) * 100;

            return (
                <div className="poem-container">
                    <h2 className="poem-title">{poem.title}</h2>
                    <div className="tts-controls">
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <label className="block">
                                <span className="text-sm font-medium mb-1 block">سرعة القراءة:</span>
                                <input
                                    type="range"
                                    min="0.5"
                                    max="2.0"
                                    step="0.1"
                                    value={ttsRate}
                                    onChange={(e) => {
                                        window.emergencyAudioStop();
                                        setTtsRate(parseFloat(e.target.value));
                                    }}
                                    className="w-full"
                                />
                                <span className="text-sm">{ttsRate.toFixed(1)}x</span>
                            </label>
                            <label className="block">
                                <span className="text-sm font-medium mb-1 block">تأخير بين الكلمات (مللي ثانية):</span>
                                <div className="flex flex-col gap-2">
                                    <div className="flex justify-between items-center">
                                        <div className="flex items-center">
                                            <button 
                                                className="px-3 py-1 bg-gray-100 hover:bg-gray-200 border rounded-r-none border-r-0"
                                                onClick={() => {
                                                    window.emergencyAudioStop();
                                                    setWordDelay(Math.max(0, wordDelay - 10));
                                                }}
                                            >-10</button>
                                            <button 
                                                className="px-3 py-1 bg-gray-100 hover:bg-gray-200 border border-r-0"
                                                onClick={() => {
                                                    window.emergencyAudioStop();
                                                    setWordDelay(Math.max(0, wordDelay - 1));
                                                }}
                                            >-1</button>
                                            <input 
                                                type="number" 
                                                value={wordDelay}
                                                onChange={(e) => {
                                                    window.emergencyAudioStop();
                                                    const val = parseInt(e.target.value);
                                                    if (!isNaN(val) && val >= 0 && val <= 3000) {
                                                        setWordDelay(val);
                                                    }
                                                }}
                                                className="w-20 text-center border px-2 py-1"
                                                min={0}
                                                max={3000}
                                                step={1}
                                            />
                                            <button 
                                                className="px-3 py-1 bg-gray-100 hover:bg-gray-200 border border-l-0"
                                                onClick={() => {
                                                    window.emergencyAudioStop();
                                                    setWordDelay(Math.min(3000, wordDelay + 1));
                                                }}
                                            >+1</button>
                                            <button 
                                                className="px-3 py-1 bg-gray-100 hover:bg-gray-200 border rounded-l-none border-l-0"
                                                onClick={() => {
                                                    window.emergencyAudioStop();
                                                    setWordDelay(Math.min(3000, wordDelay + 10));
                                                }}
                                            >+10</button>
                                        </div>
                                    </div>
                                    <div className="flex items-center">
                                        <span className="text-sm ml-2">0</span>
                                        <input
                                            type="range"
                                            min="0"
                                            max="3000"
                                            step="1"
                                            value={wordDelay}
                                            onChange={(e) => {
                                                window.emergencyAudioStop();
                                                setWordDelay(parseInt(e.target.value));
                                            }}
                                            className="w-full"
                                        />
                                        <span className="text-sm mr-2">3000</span>
                                    </div>
                                    <div className="flex justify-center text-sm font-bold">
                                        التأخير الحالي: {wordDelay} مللي ثانية
                                    </div>
                                    <div className="flex justify-center gap-2 mt-2 flex-wrap">
                                        <button 
                                            className="px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-xs"
                                            onClick={() => {
                                                window.emergencyAudioStop();
                                                setWordDelay(50);
                                            }}
                                        >50 مللي ثانية</button>
                                        <button 
                                            className="px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-xs"
                                            onClick={() => {
                                                window.emergencyAudioStop();
                                                setWordDelay(100);
                                            }}
                                        >100 مللي ثانية</button>
                                        <button 
                                            className="px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-xs"
                                            onClick={() => {
                                                window.emergencyAudioStop();
                                                setWordDelay(150);
                                            }}
                                        >150 مللي ثانية</button>
                                        <button 
                                            className="px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-xs"
                                            onClick={() => {
                                                window.emergencyAudioStop();
                                                setWordDelay(200);
                                            }}
                                        >200 مللي ثانية</button>
                                        <button 
                                            className="px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-xs"
                                            onClick={() => {
                                                window.emergencyAudioStop();
                                                setWordDelay(250);
                                            }}
                                        >250 مللي ثانية</button>
                                        <button 
                                            className="px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-xs"
                                            onClick={() => {
                                                window.emergencyAudioStop();
                                                setWordDelay(300);
                                            }}
                                        >300 مللي ثانية</button>
                                        <button 
                                            className="px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-xs"
                                            onClick={() => {
                                                window.emergencyAudioStop();
                                                setWordDelay(400);
                                            }}
                                        >400 مللي ثانية</button>
                                        <button 
                                            className="px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-xs"
                                            onClick={() => {
                                                window.emergencyAudioStop();
                                                setWordDelay(500);
                                            }}
                                        >500 مللي ثانية</button>
                                        <button 
                                            className="px-2 py-1 bg-blue-100 hover:bg-blue-200 rounded text-xs"
                                            onClick={() => {
                                                window.emergencyAudioStop();
                                                setWordDelay(1000);
                                            }}
                                        >1 ثانية</button>
                                    </div>
                                </div>
                            </label>
                        </div>
                        <div className="mt-4 flex justify-center">
                            <button
                                onClick={speakAllVerses}
                                className={`px-6 py-2 ${isPlayingAll ? 'bg-red-500 hover:bg-red-600' : 'bg-purple-500 hover:bg-purple-600'} text-white rounded-lg transition-colors duration-200 text-sm sm:text-base`}
                            >
                                {isPlayingAll ? 'إيقاف الكل' : 'تشغيل صوت الكل'}
                            </button>
                        </div>
                    </div>
                    <div className="mb-4 sm:mb-6">
                        <p className="text-center mb-2 text-sm sm:text-base">تقدم الحفظ: {memorizedCount} / {poem.verses.length}</p>
                        <div className="progress-bar">
                            <div
                                className="progress-bar-fill"
                                style={{ width: `${progress}%` }}
                            ></div>
                        </div>
                    </div>
                    {poem.verses.map((verse, index) => (
                        <Verse
                            key={index}
                            verse={verse}
                            index={index}
                            memorized={memorizedVerses[index]}
                            toggleMemorized={toggleMemorized}
                            speakVerse={speakVerse}
                            isPlayingAll={isPlayingAll}
                            audioRef={allAudioRefs.current[index]}
                            settings={settings}
                        />
                    ))}
                </div>
            );
        }

        function App() {
            const [selectedPoem, setSelectedPoem] = React.useState(poems[0]);
            const [category, setCategory] = React.useState("حفظ");
            const [showSettings, setShowSettings] = React.useState(false);
            const [settings, setSettings] = React.useState(() => {
                const savedSettings = localStorage.getItem('poemSettings');
                return savedSettings ? JSON.parse(savedSettings) : {
                    fontSize: 1.25, // rem
                    verseBackground: '#ffffff',
                    pageBackground: '#f4f4f9'
                };
            });
            const [memorizedStates, setMemorizedStates] = React.useState(
                poems.reduce((acc, poem) => {
                    acc[poem.title] = new Array(poem.verses.length).fill(false);
                    return acc;
                }, {})
            );

            // حفظ الإعدادات في التخزين المحلي
            React.useEffect(() => {
                localStorage.setItem('poemSettings', JSON.stringify(settings));
                document.body.style.backgroundColor = settings.pageBackground;
            }, [settings]);

            const filteredPoems = poems.filter(poem => poem.category === category);

            // تحديث القصيدة المختارة عند تغيير القسم
            React.useEffect(() => {
                if (filteredPoems.length > 0) {
                    setSelectedPoem(filteredPoems[0]);
                }
            }, [category]);

            const updateMemorizedState = (poemTitle, index, state) => {
                setMemorizedStates(prev => {
                    const newState = {...prev};
                    newState[poemTitle][index] = state;
                    return newState;
                });
            };

            const updateSetting = (key, value) => {
                setSettings(prev => ({
                    ...prev,
                    [key]: value
                }));
            };

            return (
                <div className="min-h-screen p-4 sm:p-6 max-w-full">
                    <h1 className="text-2xl sm:text-3xl font-bold text-center mb-6 sm:mb-8">موقع حفظ القصائد</h1>
                    
                    <div className="flex flex-col sm:flex-row sm:justify-center gap-2 sm:gap-4 mb-4 sm:mb-6">
                        <button
                            onClick={() => setCategory("حفظ")}
                            className={`px-4 py-2 rounded w-full sm:w-auto ${category === "حفظ" ? "bg-blue-600 text-white" : "bg-gray-200"}`}
                        >
                            قصائد الحفظ
                        </button>
                        <button
                            onClick={() => setCategory("شرح")}
                            className={`px-4 py-2 rounded w-full sm:w-auto ${category === "شرح" ? "bg-blue-600 text-white" : "bg-gray-200"}`}
                        >
                            قصائد الشرح
                        </button>
                        <button
                            onClick={() => setCategory("رسائل")}
                            className={`px-4 py-2 rounded w-full sm:w-auto ${category === "رسائل" ? "bg-blue-600 text-white" : "bg-gray-200"}`}
                        >
                            الرسائل
                        </button>
                        <button
                            onClick={() => setShowSettings(!showSettings)}
                            className={`px-4 py-2 rounded w-full sm:w-auto ${showSettings ? "bg-blue-600 text-white" : "bg-gray-200"}`}
                        >
                            الإعدادات
                        </button>
                    </div>

                    {showSettings && (
                        <div className="bg-white rounded-lg shadow-md p-4 mb-6">
                            <h2 className="text-xl font-bold mb-4 text-center">إعدادات التخصيص</h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label className="block text-sm font-medium mb-2">حجم النص</label>
                                    <div className="flex items-center">
                                        <span className="ml-2 text-sm">صغير</span>
                                        <input
                                            type="range"
                                            min="0.8"
                                            max="2"
                                            step="0.1"
                                            value={settings.fontSize}
                                            onChange={(e) => updateSetting('fontSize', parseFloat(e.target.value))}
                                            className="w-full"
                                        />
                                        <span className="mr-2 text-sm">كبير</span>
                                    </div>
                                    <div className="text-center mt-1 text-sm">
                                        {settings.fontSize.toFixed(1)}
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-2">لون خلفية البيت</label>
                                    <input
                                        type="color"
                                        value={settings.verseBackground}
                                        onChange={(e) => updateSetting('verseBackground', e.target.value)}
                                        className="w-full h-10 cursor-pointer"
                                    />
                                    <div className="flex mt-2">
                                        <button
                                            onClick={() => updateSetting('verseBackground', '#ffffff')}
                                            className="bg-gray-200 text-xs px-2 py-1 ml-1 rounded"
                                        >
                                            افتراضي
                                        </button>
                                        <button
                                            onClick={() => updateSetting('verseBackground', '#f0f7ff')}
                                            className="bg-blue-100 text-xs px-2 py-1 ml-1 rounded"
                                        >
                                            أزرق فاتح
                                        </button>
                                        <button
                                            onClick={() => updateSetting('verseBackground', '#fff8e1')}
                                            className="bg-yellow-100 text-xs px-2 py-1 rounded"
                                        >
                                            أصفر فاتح
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-2">لون خلفية الصفحة</label>
                                    <input
                                        type="color"
                                        value={settings.pageBackground}
                                        onChange={(e) => updateSetting('pageBackground', e.target.value)}
                                        className="w-full h-10 cursor-pointer"
                                    />
                                    <div className="flex mt-2">
                                        <button
                                            onClick={() => updateSetting('pageBackground', '#f4f4f9')}
                                            className="bg-gray-200 text-xs px-2 py-1 ml-1 rounded"
                                        >
                                            افتراضي
                                        </button>
                                        <button
                                            onClick={() => updateSetting('pageBackground', '#f7f7f7')}
                                            className="bg-white text-xs border px-2 py-1 ml-1 rounded"
                                        >
                                            أبيض
                                        </button>
                                        <button
                                            onClick={() => updateSetting('pageBackground', '#f0f7ff')}
                                            className="bg-blue-100 text-xs px-2 py-1 rounded"
                                        >
                                            أزرق فاتح
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="dropdown flex justify-center mb-4 sm:mb-6">
                        <select
                            value={selectedPoem.title}
                            onChange={(e) => {
                                const poem = poems.find(p => p.title === e.target.value);
                                setSelectedPoem(poem);
                            }}
                            className="p-2 border rounded w-full sm:w-3/4 text-sm sm:text-base"
                        >
                            {filteredPoems.map(poem => (
                                <option key={poem.title} value={poem.title}>
                                    {poem.title}
                                </option>
                            ))}
                        </select>
                    </div>

                    <Poem 
                        poem={selectedPoem} 
                        memorizedVerses={memorizedStates[selectedPoem.title]} 
                        updateMemorizedState={updateMemorizedState}
                        settings={settings}
                    />
                </div>
            );
        }

        // بناء مكون للإدخال الرقمي الدقيق
        const NumericInput = ({ value, onChange, step, min, max, label }) => {
            return (
                <div className="flex items-center">
                    <span className="text-sm">{label}:</span>
                    <div className="flex items-center mx-2 border rounded">
                        <button 
                            className="px-2 py-1 bg-gray-100 hover:bg-gray-200"
                            onClick={() => onChange(Math.max(min, value - step))}
                        >-</button>
                        <input 
                            type="number" 
                            value={value}
                            onChange={(e) => {
                                const val = parseFloat(e.target.value);
                                if (!isNaN(val) && val >= min && val <= max) {
                                    onChange(val);
                                }
                            }}
                            className="w-16 text-center"
                            min={min}
                            max={max}
                            step={step}
                        />
                        <button 
                            className="px-2 py-1 bg-gray-100 hover:bg-gray-200"
                            onClick={() => onChange(Math.min(max, value + step))}
                        >+</button>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
